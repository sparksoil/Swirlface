<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>RV Helper ‚Äî Section E2 (Garden Map)</title>
  <link rel="stylesheet" href="./rv.css?v=rv-8">
  <style>
  #mapArea {
    background-image: url('map1.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    border-radius: 12px;
    min-height: 320px; /* adjust if needed for visibility */
    position: relative;
    overflow: hidden;
  }

  #mapCanvas {
    background: transparent; /* allow image to show through */
    z-index: 2;
    position: relative;
  }
</style>
</head>
<body>
  <header class="poster">
    <h1>üå± RV Helper ‚Äî Swirly Logbook</h1>
    <p class="subtitle">Section E2: Garden Map (Constellation)</p>
  </header>

  <main class="wrap">
    <!-- ENTRY PANEL -->
    <section class="entry-panel">
      <label class="field">
        <span class="label">Person (optional)</span>
        <input id="personInput" type="text" placeholder="e.g., Sarah H.">
      </label>

      <label class="field">
        <span class="label">Notes</span>
        <textarea id="noteInput" rows="6" placeholder="Drop crumbs here‚Ä¶"></textarea>
      </label>

      <div class="actions">
        <button id="saveBtn" class="primary">Save Entry</button>
        <button id="sprinkleBtn" class="ghost">Sprinkle ‚ú®</button>
        <button id="exportBtn" class="ghost">Export (.rvpack.json)</button>
        <label class="import ghost">
          Import
          <input id="importFile" type="file" accept=".json,.rvpack.json">
        </label>
      </div>
      <p class="micro safety">Local-first save is automatic. Export/import keeps your garden safe.</p>
    </section>

    <!-- LIST PANEL -->
    <section class="list-panel" id="listPanel">
      <div class="list-head">
        <h2>Latest entries</h2>
        <div class="filters">
          <button data-filter="all" class="chip is-active">View all seeds</button>
          <button data-filter="needs" class="chip">Needs water</button>
          <button data-filter="person" class="chip">By person‚Ä¶</button>
        </div>
      </div>
      <ul id="entriesList" class="entries"></ul>
    </section>
  </main>

  <!-- PEOPLE SURFACES -->
  <section class="people-zone">
    <div class="view-switch">
      <span class="label">View:</span>
      <button id="btnViewList" class="chip is-active">List</button>
      <button id="btnViewCards" class="chip">Cards</button>
      <button id="btnViewMap" class="chip">Map</button>
    </div>

    <!-- Circles (fallback view) -->
    <h2>People as Circles</h2>
    <div id="peopleCircles" class="circles"></div>

    <!-- Cards grid -->
    <div id="cardsGrid" class="cards-grid hidden"></div>

    <!-- Garden map -->
    <div id="mapArea" class="map-area hidden">
      <canvas id="mapCanvas"></canvas>
    </div>
  </section>

  <!-- PERSON DETAIL MODAL -->
  <div id="personDetail" class="person-detail hidden" aria-modal="true" role="dialog">
    <div class="panel-content">
      <button id="closeDetail" class="ghost close-x" aria-label="Close">√ó</button>
      <h3 id="detailName">Name</h3>

      <div class="stage-row">
        <span id="detailStage" class="stage-badge">Stage 0</span>
        <span id="detailLastTouch" class="last-touch">‚Äî</span>
      </div>

      <!-- PERCEPTION CLUSTER -->
      <div id="perceptionCluster" class="percept">
        <div class="percept-grid">
          <button class="per-bubble" data-target="perc_everyday" title="Everyday details">
            <span class="per-ico">üêæ</span><span class="per-label">Everyday</span>
          </button>
          <button class="per-bubble" data-target="perc_spiritual" title="Spiritual thread">
            <span class="per-ico">üìñ</span><span class="per-label">Spiritual</span>
          </button>
          <button class="per-bubble" data-target="perc_vibe" title="Atmosphere / vibe">
            <span class="per-ico">ü™ü</span><span class="per-label">Vibe</span>
          </button>
          <button class="per-bubble" data-target="perc_next" title="Next step">
            <span class="per-ico">üéØ</span><span class="per-label">Next</span>
          </button>
          <button class="per-bubble" data-target="perc_quick" title="Quick note">
            <span class="per-ico">üìù</span><span class="per-label">Quick</span>
          </button>
        </div>

        <div class="per-edit" data-field="perc_everyday">
          <label class="field">
            <span class="label">Everyday details</span>
            <textarea id="perc_everyday" rows="2" placeholder="Dog Tim / yellow house / teen into TikTok‚Ä¶"></textarea>
          </label>
        </div>

        <div class="per-edit" data-field="perc_spiritual">
          <label class="field">
            <span class="label">Spiritual thread</span>
            <textarea id="perc_spiritual" rows="2" placeholder="Shared Psalm 34:18 / asked about forgiveness‚Ä¶"></textarea>
          </label>
          <div class="actions">
            <button id="perSpiritualSprinkle" class="ghost">Insert ‚ú® from pool</button>
          </div>
        </div>

        <div class="per-edit" data-field="perc_vibe">
          <label class="field">
            <span class="label">Atmosphere / vibe</span>
            <textarea id="perc_vibe" rows="2" placeholder="Warm but distracted by kids / didn‚Äôt open door fully‚Ä¶"></textarea>
          </label>
        </div>

        <div class="per-edit" data-field="perc_next">
          <label class="field">
            <span class="label">Next step thought</span>
            <input id="perc_next" type="text" placeholder="Bring Jonah / drop Psalm 37 / ask about mom‚Ä¶">
          </label>
        </div>

        <div class="per-edit" data-field="perc_quick">
          <label class="field">
            <span class="label">Quick note</span>
            <textarea id="perc_quick" rows="2" placeholder="Anything else small + concrete‚Ä¶"></textarea>
          </label>
        </div>
      </div>
      <!-- /PERCEPTION CLUSTER -->

      <div class="grow-controls">
        <button id="btnVisit" class="primary">Visit (+1)</button>
        <label class="care-pair">
          <input id="chkCare" type="checkbox">
          <span>Care (left note / text / call)</span>
        </label>
        <button id="btnAttempt" class="ghost">Attempt (NAH)</button>
        <button id="btnCareOnly" class="ghost">Care only (+0.5)</button>
      </div>

      <!-- action-level details for this Visit/Attempt/Care -->
      <label class="field action-note">
        <span class="label">Visit details (optional)</span>
        <textarea id="actionNote" rows="4" placeholder="What happened, scripture shared, next step‚Ä¶"></textarea>
      </label>
      <div class="actions">
        <button id="detailSprinkle" class="ghost">Sprinkle ‚ú®</button>
        <span class="micro muted">This text saves with the Visit/Attempt/Care you press.</span>
      </div>

      <hr class="soft">
      <div id="detailEntries"></div>
    </div>
  </div>

  <footer class="footer">
    <button id="devClearBtn" class="danger">Clear Dev Lab Data</button>
    <small>Section E2 active ‚Äî Garden Map view is live.</small>
  </footer>

  <!-- JS (cache-bust helps iOS) -->
  <script src="./verses.js?v=rv-8"></script>
  <script src="./rv.js?v=rv-8"></script>

  <!-- Safe boot warning (shows first JS error if any) -->
  <script>
    window.__RV_ERROR = null;
    window.addEventListener('error', function(e){ window.__RV_ERROR = e.message; });
    setTimeout(function(){
      if(!window.__RV_BOOTED){
        var warn = document.createElement('div');
        warn.style.cssText = 'position:fixed;left:0;right:0;bottom:0;padding:10px 14px;background:#8b2b2b;color:#fff;font-weight:700;z-index:9999';
        var msg = 'RV Helper: scripts did not load.';
        if (window.__RV_ERROR) msg += ' (' + window.__RV_ERROR + ')';
        warn.textContent = msg + ' Tap to retry.';
        warn.onclick = function(){ location.reload(true); };
        document.body.appendChild(warn);
      }
    }, 400);
  </script>
</body>
</html>
